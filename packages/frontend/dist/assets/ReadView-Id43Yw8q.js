import{_ as I,d as S,p as B,e as u,q as C,L as E,f as R,v as k,B as M,r as m,o as g,c as f,F as y,i as W,b as r,W as z,a as i,t as b,R as L,T as N,n as $,X as D,x as p,l as P,j as V,y as U,z as A}from"./index-PvhjrqIM.js";import{T as F}from"./TheModal-iNK0p30V.js";const j=(c,n)=>{let s;return function(...e){s&&clearTimeout(s),s=setTimeout(()=>{c.apply(this,e)},n)}},q={50:"w-1/2",60:"w-3/5",70:"w-[70%]",80:"w-4/5",90:"w-[90%]",100:"w-full"},H={name:"TheRead",components:{TheImage:S},props:{pages:{type:Number,required:!0},imageWidth:{type:String,default:"100"}},setup(c){const n=B(),{id:s,chapter:e}=n.params,d=u(0),h=u("0"),o=Array.from({length:c.pages},(a,v)=>`${v+1}.webp`),t=u([]),l=()=>{const a=new Date;d.value=a.getHours(),h.value=a.getMinutes().toString().padStart(2,"0")};l(),setInterval(l,2e4);const w=C(()=>q[c.imageWidth]),x=u("p1");E(x,a=>{localStorage.setItem(`${s}-${e}`,String(a))});const _=new IntersectionObserver((a,v)=>{a.forEach(T=>{T.intersectionRatio===1&&(x.value=T.target.id)})},{threshold:1});return R(()=>{t.value.forEach(a=>{_.observe(a)})}),k(()=>{t.value.forEach(a=>{_.unobserve(a)})}),{BASE_URL:M,comicPageList:o,id:s,chapter:e,hours:d,minutes:h,imageWidthClass:w,comicPages:t}}},O=["id"],X={class:"fixed bottom-0 left-0 px-2 rounded bg-black opacity-80 text-sm text-white"};function Y(c,n,s,e,d,h){const o=m("TheImage");return g(),f(y,null,[(g(!0),f(y,null,W(e.comicPageList,(t,l)=>(g(),f("div",{ref_for:!0,ref:"comicPages",key:t,class:"relative mx-auto top-20 px-4 my-3 max-w-xl",id:`p${l+1}`},[r(o,{src:`${e.BASE_URL}/${e.id}/${e.chapter}/${t}`,lazy:!0,class:z([e.imageWidthClass,"mx-auto"])},null,8,["src","class"])],8,O))),128)),i("span",X,b(e.hours)+":"+b(e.minutes),1)],64)}const G=I(H,[["render",Y]]),J={name:"ReadView",components:{TheRead:G,TheNavigation:L,TheImage:S,TheIcon:N,TheButton:$,TheModal:F},setup(){const c=B(),{id:n,chapter:s}=c.params,e=u(0),d=u(!1),h=u("100"),o=(()=>{let t=0;return j(()=>{const l=window.scrollY;l-t>0?d.value=!0:d.value=!1,t=l},100)})();return R(async()=>{const t=await D(n,s);e.value=t.data.pages,window.addEventListener("scroll",o)}),k(()=>{window.removeEventListener("scroll",o)}),{pages:e,isScrollingDown:d,imageWidth:h}}},K={class:"relative"},Q=i("div",{class:"w-full flex justify-between text-xs px-1"},[i("span",null,"|"),i("span",null,"|"),i("span",null,"|"),i("span",null,"|"),i("span",null,"|"),i("span",null,"|")],-1);function Z(c,n,s,e,d,h){const o=m("TheIcon"),t=m("router-link"),l=m("TheButton"),w=m("TheModal"),x=m("TheNavigation"),_=m("TheRead");return g(),f("main",K,[r(x,{class:z([{"-translate-y-16":e.isScrollingDown},"z-50 transition-all shadow-md shadow-primary duration-500"])},{left:p(()=>[r(t,{to:{name:"book"},class:"relative btn btn-ghost text-white",replace:""},{default:p(()=>[r(o,{type:"arrow-left",size:"lg",class:"xl:text-xl 2xl:text-2xl"})]),_:1})]),right:p(()=>[r(l,{type:"ghost",shape:"circle",size:"md",onclick:"document.getElementById('resizeImageModal').showModal()"},{default:p(()=>[r(o,{type:"magnifying-glass-plus",size:"lg",class:"xl:text-xl 2xl:text-2xl text-white"})]),_:1}),r(w,{id:"resizeImageModal",class:"fixed top-8"},{default:p(()=>[U(i("input",{type:"range",min:"50",max:"100",value:"100",step:"10",class:"range range-info range-xs","onUpdate:modelValue":n[0]||(n[0]=a=>e.imageWidth=a)},null,512),[[A,e.imageWidth]]),Q]),_:1}),r(t,{to:{name:"home"},class:"relative btn btn-ghost btn-circle text-white"},{default:p(()=>[r(o,{type:"house",size:"lg",class:"xl:text-xl 2xl:text-2xl"})]),_:1})]),_:1},8,["class"]),e.pages?(g(),P(_,{key:0,pages:e.pages,"image-width":e.imageWidth},null,8,["pages","image-width"])):V("",!0)])}const ae=I(J,[["render",Z]]);export{ae as default};
