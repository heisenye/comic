import{_ as v,m as $,T as S,r as c,o as g,c as _,a,H as E,b as l,w as u,d as k,C as B,f as p,I as M,J as L,h as z,K as C,B as N,F as b,j as W,L as R,t as I,A as P,M as V,s as D,k as A,N as U,O as F}from"./index-Z0csONL9.js";const j={name:"TheModal",components:{TheButton:$,TheIcon:S},props:{id:{type:String,default:"modal"}}},H=["id"],O={class:"modal-box"},q={method:"dialog"},J=a("form",{method:"dialog",class:"modal-backdrop"},[a("button")],-1);function K(i,d,m,e,r,h){const n=c("TheIcon"),t=c("TheButton");return g(),_("dialog",{id:m.id,class:"modal"},[a("div",O,[E(i.$slots,"default"),a("form",q,[l(t,{type:"ghost",size:"sm",shape:"circle",class:"absolute right-1 top-1"},{default:u(()=>[l(n,{type:"xmark-circle",size:"lg",class:"xl:text-xl 2xl:text-2xl"})]),_:1})])]),J],8,H)}const Y=v(j,[["render",K]]),G={50:"w-1/2",60:"w-3/5",70:"w-[70%]",80:"w-4/5",90:"w-[90%]",100:"w-full"},Q={name:"TheRead",components:{TheImage:k},props:{pages:{type:Number,required:!0},imageWidth:{type:String,default:"100"}},setup(i){const d=B(),{id:m,chapter:e}=d.params,r=p(0),h=p("0"),n=Array.from({length:i.pages},(o,T)=>`${T+1}.webp`),t=p([]),s=()=>{const o=new Date;r.value=o.getHours(),h.value=o.getMinutes().toString().padStart(2,"0")};s(),setInterval(s,2e4);const w=M(()=>G[i.imageWidth]),x=p("p1");L(x,o=>{localStorage.setItem(`${m}-${e}`,String(o))});const f=new IntersectionObserver((o,T)=>{o.forEach(y=>{y.intersectionRatio===1&&(x.value=y.target.id)})},{threshold:1});return z(()=>{t.value.forEach(o=>{f.observe(o)})}),C(()=>{t.value.forEach(o=>{f.unobserve(o)})}),{BASE_URL:N,comicPageList:n,id:m,chapter:e,hours:r,minutes:h,imageWidthClass:w,comicPages:t}}},X=["id"],Z={class:"fixed bottom-0 left-0 px-2 rounded bg-black opacity-80 text-sm text-white"};function ee(i,d,m,e,r,h){const n=c("TheImage");return g(),_(b,null,[(g(!0),_(b,null,W(e.comicPageList,(t,s)=>(g(),_("div",{ref_for:!0,ref:"comicPages",key:t,class:"relative mx-auto top-20 px-4 my-3 max-w-xl",id:`p${s+1}`},[l(n,{src:`${e.BASE_URL}/${e.id}/${e.chapter}/${t}`,lazy:!0,class:R([e.imageWidthClass,"mx-auto"])},null,8,["src","class"])],8,X))),128)),a("span",Z,I(e.hours)+":"+I(e.minutes),1)],64)}const te=v(Q,[["render",ee]]),se={name:"ReadView",components:{TheRead:te,TheNavigation:P,TheImage:k,TheIcon:S,TheButton:$,TheModal:Y},setup(){const i=B(),{id:d,chapter:m}=i.params,e=p(0),r=p(!1),h=p("100");let n=0;const t=()=>{const s=window.scrollY;s-n>0?r.value=!0:r.value=!1,n=s};return z(async()=>{try{const s=await V(d,m);e.value=s.data.pages}catch(s){console.error(s)}window.addEventListener("scroll",t)}),C(()=>{window.removeEventListener("scroll",t)}),{pages:e,isScrollingDown:r,imageWidth:h}}},oe={class:"relative"},ae=a("div",{class:"w-full flex justify-between text-xs px-1"},[a("span",null,"|"),a("span",null,"|"),a("span",null,"|"),a("span",null,"|"),a("span",null,"|"),a("span",null,"|")],-1);function ne(i,d,m,e,r,h){const n=c("TheIcon"),t=c("router-link"),s=c("TheButton"),w=c("TheModal"),x=c("TheNavigation"),f=c("TheRead");return g(),_("main",oe,[l(x,{class:R([{"-translate-y-16":e.isScrollingDown},"z-50 transition-all shadow-md shadow-primary duration-500"])},{left:u(()=>[l(t,{to:{name:"book"},class:"relative btn btn-ghost text-white",replace:""},{default:u(()=>[l(n,{type:"arrow-left",size:"lg",class:"xl:text-xl 2xl:text-2xl"})]),_:1})]),right:u(()=>[l(s,{type:"ghost",shape:"circle",size:"md",onclick:"document.getElementById('resizeImage').showModal()"},{default:u(()=>[l(n,{type:"magnifying-glass-plus",size:"lg",class:"xl:text-xl 2xl:text-2xl text-white"})]),_:1}),l(w,{id:"resizeImage",class:"fixed top-0"},{default:u(()=>[U(a("input",{type:"range",min:"50",max:"100",value:"100",step:"10",class:"range range-info range-xs","onUpdate:modelValue":d[0]||(d[0]=o=>e.imageWidth=o)},null,512),[[F,e.imageWidth]]),ae]),_:1}),l(t,{to:{name:"home"},class:"relative btn btn-ghost btn-circle text-white"},{default:u(()=>[l(n,{type:"house",size:"lg",class:"xl:text-xl 2xl:text-2xl"})]),_:1})]),_:1},8,["class"]),e.pages?(g(),D(f,{key:0,pages:e.pages,"image-width":e.imageWidth},null,8,["pages","image-width"])):A("",!0)])}const re=v(se,[["render",ne]]);export{re as default};
