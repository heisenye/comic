import{_ as S,d as O,T as B,B as U,r as l,o as u,c as v,a as t,b as n,t as p,m as i,F as w,n as D,p as M,e as T,q as H,f as L,s as j,v as q,l as k,x as _,j as N,y as R,z as $,i as F,A as K,C as G,D as V,E as J,G as C,H as I,I as Q,J as W,K as X,L as Y,M as Z,N as ee,O as te,P as oe,Q as se,R as ne,S as ae,U as ce,V as le}from"./index-PvhjrqIM.js";import{T as re}from"./TheModal-iNK0p30V.js";const ie={name:"TheComment",components:{TheImage:O,TheIcon:B},props:{comment:{type:Object,required:!0}},setup(r){const{content:o,createdAt:d,likes:e,userId:c}=r.comment,{_id:f,username:a}=c;return{uid:f,username:a,createdAt:d,content:o,likes:e,BASE_URL:U}}},de=t("div",{class:"divider divider-neutral"},null,-1),me={class:"navbar px-0 gap-x-3"},pe={class:"flex-none size-12 rounded-full bg-primary overflow-hidden"},ue={class:"flex-1 flex-col items-start font-Noto"},_e={class:"text-base text-white"},he={class:"text-xs text-accent-content"},xe={class:"text-neutral-content"},fe={class:"flex-none text-neutral-content"};function ge(r,o,d,e,c,f){const a=l("TheImage"),s=l("TheIcon");return u(),v(w,null,[de,t("main",me,[t("div",pe,[n(a,{blur:!1,class:"size-full rounded-full z-10 border-2 border-neutral",src:`${e.BASE_URL}/avatar/${e.uid}.webp`},null,8,["src"])]),t("div",ue,[t("h3",_e,p(e.username),1),t("div",he,p(new Date(e.createdAt).toLocaleString()),1),t("p",xe,p(e.content),1)]),t("div",fe,[n(s,{type:"thumbs-up"}),i("    "),t("span",null,p(e.likes),1)])])],64)}const be=S(ie,[["render",ge]]),ve={name:"TheComments",components:{TheButton:D,TheIcon:B,TheComment:be},setup(){const r=M(),{id:o}=r.params,{token:d}=V(),e=T(""),c=T(null),f=H(()=>!e.value),a=T(!1),s=new IntersectionObserver(x=>{x.forEach(m=>{console.log(m),a.value=!m.isIntersecting})},{root:null,rootMargin:"0px 0px 9999px 0px"}),h=T([]);return L(async()=>{const x=await j(o);x.code===200&&(h.value=x.data),s.observe(c.value)}),q(()=>{a.value&&s.unobserve(c.value)}),{token:d,inputComment:e,commentInputEl:c,isSubmitDisabled:f,isScrollButtonShow:a,comments:h,commentSubmitHandler:async()=>{const x=await J({id:o,content:e.value});x&&x.code===200&&(C({msg:I.SUBMIT_COMMENT_SUCCESS,messageType:"success",popupType:"toast",toastPos:["bottom","right"]}),setTimeout(()=>{Q()},1e3))},scrollToCommentInputEl:()=>{c.value.scrollIntoView({behavior:"smooth",block:"start"})}}}},Te=r=>(W("data-v-efa79207"),r=r(),X(),r),ye={class:"relative top-4 w-full mx-auto px-4 pb-4 card rounded max-w-3xl bg-primary"},we=Te(()=>t("h1",{class:"text-xl mt-6 mb-8 text-center font-base font-black"},"评论",-1)),ke=["disabled"];function Ce(r,o,d,e,c,f){const a=l("RouterLink"),s=l("TheButton"),h=l("TheComment"),b=l("TheIcon");return u(),v(w,null,[t("main",ye,[we,e.token?N("",!0):(u(),k(a,{key:0,to:{name:"login"},class:"text-xs link-info link-hover self-center font-base mb-3"},{default:_(()=>[i("当前未登录,立即登录")]),_:1})),R(t("textarea",{ref:"commentInputEl",disabled:!e.token,"onUpdate:modelValue":o[0]||(o[0]=g=>e.inputComment=g),placeholder:"输入评论",rows:"3",class:"textarea textarea-secondary text-accent-content mb-4"},null,8,ke),[[$,e.inputComment]]),n(s,{type:"neutral",disabled:e.isSubmitDisabled,class:"h-10 w-20 self-end font-base",onClick:e.commentSubmitHandler},{default:_(()=>[i("提交")]),_:1},8,["disabled","onClick"]),(u(!0),v(w,null,F(e.comments,g=>(u(),k(h,{comment:g},null,8,["comment"]))),256))]),n(G,null,{default:_(()=>[R(n(s,{type:"info",shape:"circle",style:{translate:"-50% 0"},class:"fixed top-20 left-1/2 shadow-md shadow-info",onClick:e.scrollToCommentInputEl},{default:_(()=>[n(b,{type:"arrow-up"})]),_:1},8,["onClick"]),[[K,e.isScrollButtonShow]])]),_:1})],64)}const Ie=S(ve,[["render",Ce],["__scopeId","data-v-efa79207"]]),Se={name:"TheBook",components:{TheComments:Ie,TheButton:D,TheIcon:B,TheImage:O,TheModal:re},props:{comic:{type:Object,required:!0}},setup(r){const o=M(),{comic:d}=r,{token:e}=V(),c=T(!1),f=T(o.meta.isProgressRemembered);Y(f,y=>{localStorage.setItem("isProgressRemembered",String(y)),o.meta.isProgressRemembered=y});const{name:a,_id:s,coverImage:h,updatedAt:b,chapters:g,author:x,tags:m,description:z,status:A}=d,{viewCount:P,favoriteCount:E}=Z(d);return L(async()=>{if(!e.value)return;(await ee(s)).data&&(c.value=!0)}),{BASE_URL:U,isFavorited:c,isProgressRemembered:f,id:s,coverImage:h,name:a,date:b,viewCount:P,favoriteCount:E,chapters:g,author:x,tags:m,description:z,status:A,addOrDeleteFavoriteFn:async()=>{if(!e.value){C({msg:I.NO_TOKEN,messageType:"info",popupType:"alert"});return}c.value?(await oe(s)).code===200&&(c.value=!1,E.value--,C({msg:I.DELETE_FAVORITE_SUCCESS,messageType:"success",popupType:"toast",toastPos:["end","bottom"]})):(await se({id:s})).code===200&&(c.value=!0,E.value++,C({msg:I.ADD_FAVORITE_SUCCESS,messageType:"success",popupType:"toast",toastPos:["start","bottom"]}))}}}},Be={class:"relative w-full top-20 px-3 sm:px-4 md:px-8 lg:px-4 pb-8"},Ee={class:"relative w-full mx-auto card rounded max-w-3xl bg-primary lg:card-side lg:py-4"},Re={key:0,class:"absolute bookmark border-[32px] -left-4 -top-4 xl:border-[40px]"},Fe=t("p",{class:"absolute -left-6 -top-6 text-warning-content xl:text-lg font-base font-extrabold"}," 完结 ",-1),De=[Fe],Me={class:"relative flex items-center justify-center pb-6 pt-8 md:px-6 lg:px-0 xl:px-4 lg:w-3/5"},Le={class:"card-body pt-4 md:pt-6 px-6 md:px-10 lg:px-4 rounded-b-xl xl:text-lg"},Ne={class:"card-title text-2xl self-center pb-2 font-base font-extrabold text-white"},Oe={class:"text-accent opacity-80"},Ue=t("i",{class:"fa-solid fa-eye"},null,-1),Ve=t("i",{class:"fa-solid fa-heart"},null,-1),ze=t("i",{class:"fa-solid fa-book"},null,-1),Ae={class:"text-white font-base"},Pe={class:"btn btn-sm btn-secondary"},He={class:"space-x-1.5 text-white font-base"},je={class:"text-white font-base"},qe={class:"opacity-80"},$e=t("h3",{class:"font-base text-lg mx-auto"},"章节",-1),Ke={class:"flex items-center"},Ge=t("label",{for:"progress",class:"mr-6"},"是否记忆阅读进度",-1),Je={class:"grid grid-cols-4 gap-x-6 place-items-center"};function Qe(r,o,d,e,c,f){const a=l("TheImage"),s=l("TheButton"),h=l("TheIcon"),b=l("TheModal"),g=l("RouterLink"),x=l("TheComments");return u(),v("main",Be,[t("div",Ee,[e.status==="completed"?(u(),v("div",Re,De)):N("",!0),t("div",Me,[n(a,{src:`${e.BASE_URL}/${e.id}/${e.coverImage.chapter}/${e.coverImage.page}.webp`,class:"rounded-lg w-3/5 lg:rounded-lg h-fit"},null,8,["src"])]),t("div",Le,[t("h1",Ne,p(e.name),1),t("div",Oe,[t("span",null,p(new Date(e.date).toLocaleDateString()),1),i("  |  "),Ue,i("  "),t("span",null,p(e.viewCount),1),i("  "),Ve,i("  "),t("span",null,p(e.favoriteCount),1),i("  |  "),ze,i("  "),t("span",null,p(e.chapters),1)]),t("div",Ae,[i(" 作者："),t("button",Pe,p(e.author),1)]),t("div",He,[i(" 标签： "),(u(!0),v(w,null,F(e.tags,m=>(u(),k(s,{key:m,type:"secondary",size:"sm"},{default:_(()=>[i(p(m),1)]),_:2},1024))),128))]),t("div",je,[i(" 简介："),t("span",qe,p(e.description),1)]),n(s,{type:"error",class:"w-32 lg:w-28 xl:w-32 mx-auto my-3",onClick:e.addOrDeleteFavoriteFn},{default:_(()=>[n(h,{type:"heart",class:"text-lg lg:text-md xl:text-lg text-white",variant:e.isFavorited?"solid":"regular"},null,8,["variant"])]),_:1},8,["onClick"]),$e,t("div",null,[n(s,{type:"secondary",size:"sm",shape:"square",class:"block mx-auto",onclick:"document.getElementById('settings').showModal()"},{default:_(()=>[n(h,{type:"gear",class:"text-success"})]),_:1})]),n(b,{id:"settings",class:"bg-primary font-base"},{default:_(()=>[t("div",Ke,[Ge,R(t("input",{type:"checkbox",id:"progress",value:"true","onUpdate:modelValue":o[0]||(o[0]=m=>e.isProgressRemembered=m),class:"checkbox checkbox-xs checkbox-success"},null,512),[[te,e.isProgressRemembered]])])]),_:1}),t("div",Je,[(u(!0),v(w,null,F(e.chapters,m=>(u(),k(g,{key:m,to:{name:"read",params:{id:e.id,chapter:m}},class:"btn btn-sm btn-secondary w-12",replace:""},{default:_(()=>[i(p(m),1)]),_:2},1032,["to"]))),128))])])]),n(x)])}const We=S(Se,[["render",Qe]]),Xe={name:"BookView",components:{TheBook:We,TheNavigation:ne,TheButton:D,TheIcon:B},setup(){const r=M(),{id:o}=r.params,d=T(null);return L(async()=>{const e=await ae(o);e.code===200&&(d.value=e.data)}),{comic:d,goBack:ce,goHome:le}}},Ye=t("span",{class:"text-xl 2xl:text-2xl 2xl:tracking-wider"},"<  Back",-1),Ze=[Ye],et={class:"nav-input-container"},tt=t("input",{type:"text",placeholder:"搜索标题或标签",class:"nav-input"},null,-1);function ot(r,o,d,e,c,f){const a=l("TheIcon"),s=l("TheButton"),h=l("TheNavigation"),b=l("TheBook");return u(),v("main",null,[n(h,{class:"z-50 shadow-md shadow-primary"},{left:_(()=>[t("div",{class:"text-white btn btn-ghost tracking-wider font-medium text-lg px-4",onClick:o[0]||(o[0]=(...g)=>e.goBack&&e.goBack(...g))},Ze)]),right:_(()=>[t("div",et,[tt,n(a,{type:"magnifying-glass",class:"absolute left-4"})]),n(s,{type:"ghost",size:"md",shape:"circle",class:"lg:hidden btn-md text-white"},{default:_(()=>[n(a,{type:"magnifying-glass",class:"text-base sm:text-lg xl:text-xl 2xl:text-2xl lg:hidden"})]),_:1}),n(s,{type:"ghost",size:"md",shape:"circle",class:"btn-md text-white",onClick:e.goHome},{default:_(()=>[n(a,{type:"house",class:"text-base sm:text-lg xl:text-xl 2xl:text-2xl"})]),_:1},8,["onClick"])]),_:1}),e.comic?(u(),k(b,{key:0,comic:e.comic,class:"z-0"},null,8,["comic"])):N("",!0)])}const ct=S(Xe,[["render",ot]]);export{ct as default};
