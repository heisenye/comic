import{_ as A,T as k,n as T,a5 as R,a1 as U,e as f,f as C,a6 as L,v as I,B as O,c as j,a as e,b as l,x as c,t as g,D as z,G as p,H as u,a7 as B,I as E,r as m,o as S,m as V}from"./index-PvhjrqIM.js";const D=["image/jpeg","image/png","image/jpg"],M={name:"ProfileView",components:{TheIcon:k,TheButton:T,TheAvatar:R},setup(){const _=U(),{token:o}=z(),n=f(),a=f(),t=f(""),h=()=>{URL.revokeObjectURL(t.value),t.value="",p({msg:u.UPLOAD_ERROR,messageType:"error",popupType:"alert"})},d=()=>{URL.revokeObjectURL(t.value),t.value="",n.value.value=null},v=()=>{const s=n.value.files[0];if(!s)return;const x=s.type;if(D.includes(x))t.value=URL.createObjectURL(s),a.value.showModal();else{p({msg:u.AVATAR_FORMAT_ERROR,messageType:"error",popupType:"alert"}),n.value.value=null;return}s.size>1024*1024*10&&(p({msg:u.AVATAR_SIZE_ERROR,messageType:"error",popupType:"alert"}),n.value.value=null)},r=async()=>{p({msg:u.UPLOADING,messageType:"info",popupType:"alert"});const s=new FormData;s.append("avatar",n.value.files[0]),(await B(s)).code===200&&E()};C(async()=>{const s=await L(o.value);s.code===200&&_.setUser(s.data)}),I(()=>{t.value&&URL.revokeObjectURL(t.value)});const{username:i,id:w,createdAt:y,logout:b}=_;return{username:i,id:w,createdAt:y,previewSrc:t,uploadAvatarInput:n,previewAvatarModal:a,previewAvatar:v,uploadError:h,cancelUpload:d,uploadAvatar:r,logout:b,BASE_URL:O}}},P={class:"absolute top-36 w-full px-3 md:px-4 lg:px-5"},N={class:"relative max-w-2xl w-full left-1/2 -translate-x-1/2 space-y-4 grid grid-cols-1 lg:grid-cols-2 lg:gap-x-3"},F={class:"navbar rounded-xl bg-primary w-full text-sm px-4 lg:col-span-2"},G={class:"mx-4 lg:mx-6 flex-1"},H={class:"text-xl lg:text-2xl tracking-wider"},Z={class:"navbar rounded-xl bg-primary w-full px-4"},q={class:"flex-none lg:flex lg:flex-col lg:w-full lg:items-start lg:pl-2"},J=e("span",{class:"text-xl pr-4 tracking-widest text-white"},"UID",-1),K={class:"text-sm tracking-wider"},Q={class:"navbar px-4 rounded-xl bg-primary w-full text-lg"},W=e("span",{class:"pr-6 tracking-wider text-white font-base font-black"},"注册时间",-1),X={class:"tracking-wide"},Y={class:"modal",ref:"previewAvatarModal"},$={class:"modal-box bg-primary"},ee={method:"dialog"},ae={class:"relative flex justify-center z-0"},se={class:"rounded-full h-28 w-28 md:h-32 md:w-32 lg:h-36 lg:w-36 overflow-hidden"},te=["src"],oe={class:"flex justify-center"},le=e("span",{class:"font-base"},"上传",-1),ne={method:"dialog",class:"hidden lg:block mx-auto"},re=e("span",{class:"font-base"},"取消",-1),ce={method:"dialog",class:"modal-backdrop"};function ie(_,o,n,a,t,h){const d=m("TheIcon"),v=m("TheAvatar"),r=m("TheButton");return S(),j("main",P,[e("div",N,[e("div",F,[l(r,{type:"secondary",shape:"circle",class:"relative size-20 lg:size-24 overflow-hidden"},{default:c(()=>[e("input",{type:"file",class:"hidden h-0 w-0",ref:"uploadAvatarInput",onChange:o[0]||(o[0]=(...i)=>a.previewAvatar&&a.previewAvatar(...i))},null,544),l(v,{class:"w-full hover:opacity-40 hover:scale-110 transition-all duration-500 z-20",onClick:o[1]||(o[1]=()=>a.uploadAvatarInput.click())},{default:c(()=>[l(d,{type:"user",size:"2xl",class:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 lg:text-3xl text-neutral"})]),_:1})]),_:1}),e("div",G,[e("span",H,g(a.username),1)]),l(r,{type:"error",class:"z-50 h-10 lg:h-12 lg:w-20 lg:text-base font-base",onClick:a.logout},{default:c(()=>[V(" 登出 ")]),_:1},8,["onClick"])]),e("div",Z,[e("div",q,[J,e("span",K,g(a.id),1)])]),e("div",Q,[W,e("span",X,g(a.createdAt),1)])]),e("dialog",Y,[e("div",$,[e("form",ee,[l(r,{type:"ghost",shape:"circle",class:"absolute right-0 top-0 z-10"},{default:c(()=>[l(d,{type:"xmark-circle",class:"text-lg"})]),_:1})]),e("div",ae,[e("div",se,[e("img",{src:a.previewSrc,alt:"",class:"w-full h-full object-cover"},null,8,te)])]),e("div",oe,[l(r,{type:"neutral",class:"w-32 lg:w-20 mx-auto my-3",onClick:a.uploadAvatar},{default:c(()=>[le]),_:1},8,["onClick"]),e("form",ne,[l(r,{type:"info",class:"w-20 my-3",onClick:a.cancelUpload},{default:c(()=>[re]),_:1},8,["onClick"])])])]),e("form",ce,[e("button",{onClick:o[2]||(o[2]=(...i)=>a.cancelUpload&&a.cancelUpload(...i))})])],512)])}const pe=A(M,[["render",ie]]);export{pe as default};
